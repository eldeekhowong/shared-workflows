name: EITS Mule Pipeline

on:
  workflow_call:

jobs:
  Feature-Branch-Commit:
    if: ${{ startsWith(GITHUB.ref_name,'feature/') && GITHUB.event_name == 'push'}}
    uses: eldeekhowong/shared-workflows/.github/workflows/build-deploy-promote.yml@main
    secrets: inherit
    with:
      build-deploy-promote: 'build'
      code-coverage-required: false

  Develop-PR:
    if: ${{ GITHUB.base_ref == 'develop' && GITHUB.event_name == 'pull_request'}}
    uses: eldeekhowong/shared-workflows/.github/workflows/build-deploy-promote.yml@main
    secrets: inherit
    with:
      build-deploy-promote: 'build'
      code-coverage-required: false #switch to true

  Develop-Merge:
    if: ${{ GITHUB.base_ref == 'develop' && GITHUB.event.pull_request.merged == true}}
    uses: eldeekhowong/shared-workflows/.github/workflows/build-deploy-promote.yml@main
    secrets: inherit
    with:
      build-deploy-promote: 'deploy'
      code-coverage-required: false #switch to true

  Promote-Build-Action:
    if: ${{ inputs.action == 'Promote' && GITHUB.event_name == 'workflow_dispatch'}}
    uses: eldeekhowong/shared-workflows/.github/workflows/build-deploy-promote.yml@main
    secrets: inherit
    with:
      build-deploy-promote: 'promote'
      code-coverage-required: false
      muleEnv: ${{ inputs.muleEnv }}
      artifactGroup: ${{ inputs.artifactGroup }}
      tag: ${{GITHUB.ref_name}}